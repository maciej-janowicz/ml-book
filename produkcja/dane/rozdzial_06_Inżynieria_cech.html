
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Inżynieria cech &#8212; Elementarne uczenie maszynowe</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'produkcja/dane/rozdzial_06_Inżynieria_cech';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Elementarne uczenie maszynowe - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="Elementarne uczenie maszynowe - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../podstawy/rozdzial_01_Wst%C4%99p_do_uczenia_maszynowego.html">Wstęp do uczenia maszynowego</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../podstawy/rozdzial_02_Rodzaje_uczenia_maszynowego.html">Rodzaje uczenia maszynowego</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../podstawy/rozdzial_03_Matematyka_w_uczeniu_maszynowym.html">Matematyka w uczeniu maszynowym</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../podstawy/rozdzial_04_Wst%C4%99pne_przetwarzanie_danych.html">Wstępne przetwarzanie danych</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../biblioteki/rozdzial_07_TensorFlow.html">Biblioteka TensorFlow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../biblioteki/rozdzial_08_PyTorch.html">Biblioteka Pytorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../klasyczne_ml/rozdzial_09_Uczenie_nadzorowane.html">Uczenie nadzorowane</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../klasyczne_ml/rozdzial_10_Uczenie_nienadzorowane.html">Uczenie nienadzorowane</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../klasyczne_ml/rozdzial_11_Modele_liniowe_i_drzewiaste.html">Modele liniowe i drzewiaste</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../klasyczne_ml/rozdzial_13_Klasyfikacja_binarna_%C4%87wiczenia.html">Klasyfikacja binarna - ćwiczenia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walidacja/rozdzial_14_Walidacja_modeli.html">Walidacja modeli</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../g%C5%82%C4%99bokie_ml/rozdzial_15_Sieci_CNN.html">Sieci konwolucyjne</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../g%C5%82%C4%99bokie_ml/rozdzial_16_Sieci_RNN.html">Sieci rekurencyjne</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../g%C5%82%C4%99bokie_ml/rozdzial_17_Sieci_LSTM.html">Sieci LSTM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../g%C5%82%C4%99bokie_ml/rozdzial_18_Sieci_GAN.html">Sieci GAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../g%C5%82%C4%99bokie_ml/rozdzial_19_Architektury_sieci_neuronowych_1.html">Architektury sieci neuronowych, część 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../g%C5%82%C4%99bokie_ml/rozdzial_20_Transformery.html">Wstęp do transformerów</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ensembling/rozdzial_21_Ensembling.html">Metody zespołowe</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/maciej-janowicz/ml-book" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/produkcja/dane/rozdzial_06_Inżynieria_cech.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Inżynieria cech</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Inżynieria cech</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wprowadzenie">Wprowadzenie</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#podstawowe-techniki-inzynierii-cech">Podstawowe techniki inżynierii cech</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transformacje-numeryczne">1. Transformacje numeryczne</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kodowanie-zmiennych-kategorycznych">2. Kodowanie zmiennych kategorycznych</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tworzenie-nowych-cech">3. Tworzenie nowych cech</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selekcja-cech">4. Selekcja cech</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ekstrakcja-cech">5. Ekstrakcja cech</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#przyklad-1-klasyfikacja-kompleksowa-inzynieria-cech-dla-zbioru-ocalalych-z-katastrofy-titanica">Przykład 1: Klasyfikacja - Kompleksowa inżynieria cech dla zbioru ocalałych z katastrofy Titanica</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#przyklad-2-regresja-transformacje-i-cechy-wielomianowe">Przykład 2: Regresja - Transformacje i cechy wielomianowe</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#przyklad-3-klasteryzacja-redukcja-wymiarowosci-i-transformacje">Przykład 3: Klasteryzacja - Redukcja wymiarowości i transformacje</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#podsumowanie">Podsumowanie</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dodatkowe-techniki">Dodatkowe techniki</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#narzedzia">Narzędzia</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="inzynieria-cech">
<h1>Inżynieria cech<a class="headerlink" href="#inzynieria-cech" title="Link to this heading">#</a></h1>
<section id="wprowadzenie">
<h2>Wprowadzenie<a class="headerlink" href="#wprowadzenie" title="Link to this heading">#</a></h2>
<p>Inżynieria cech (ang. “feature engineering”) to proces tworzenia, przekształcania i selekcjonowania cech w celu poprawy wydajności modeli uczenia maszynowego. Często mówi się, że dobre cechy są ważniejsze niż sam algorytm - nawet prosty model z dobrymi cechami może przewyższyć skomplikowany model z surowymi danymi. Należy jednak uważać, aby nie przesadzić - bywa i tak, że nadmiar wprowadzonych cech (lub nietrafne ich określanie) może właśnie popsuć model.</p>
</section>
<section id="podstawowe-techniki-inzynierii-cech">
<h2>Podstawowe techniki inżynierii cech<a class="headerlink" href="#podstawowe-techniki-inzynierii-cech" title="Link to this heading">#</a></h2>
<section id="transformacje-numeryczne">
<h3>1. Transformacje numeryczne<a class="headerlink" href="#transformacje-numeryczne" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Skalowanie</strong>: StandardScaler, MinMaxScaler, RobustScaler</p></li>
<li><p><strong>Transformacje nieliniowe</strong>: logarytm, pierwiastek, potęgowanie</p></li>
<li><p><strong>Binning</strong>: dyskretyzacja ciągłych wartości na przedziały</p></li>
</ul>
</section>
<section id="kodowanie-zmiennych-kategorycznych">
<h3>2. Kodowanie zmiennych kategorycznych<a class="headerlink" href="#kodowanie-zmiennych-kategorycznych" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>One-Hot Encoding</strong>: dla zmiennych nominalnych (bez porządku)</p></li>
<li><p><strong>Label Encoding</strong>: dla zmiennych uporządkowanych (z porządkiem, dających się ustawić w ciąg)</p></li>
<li><p><strong>Target Encoding</strong>: średnia wartości docelowej dla każdej kategorii</p></li>
<li><p><strong>Frequency Encoding</strong>: częstość występowania kategorii</p></li>
</ul>
</section>
<section id="tworzenie-nowych-cech">
<h3>3. Tworzenie nowych cech<a class="headerlink" href="#tworzenie-nowych-cech" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Interakcje</strong>: kombinacje istniejących cech (mnożenie, dzielenie)</p></li>
<li><p><strong>Agregacje</strong>: statystyki grupowe (suma, średnia, odchylenie)</p></li>
<li><p><strong>Cechy domenowe</strong>: wykorzystanie wiedzy o problemie</p></li>
<li><p><strong>Cechy czasowe</strong>: dzień tygodnia, miesiąc, sezonowość</p></li>
</ul>
</section>
<section id="selekcja-cech">
<h3>4. Selekcja cech<a class="headerlink" href="#selekcja-cech" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Filter methods</strong>: korelacja, test chi-kwadrat, mutual information</p></li>
<li><p><strong>Wrapper methods</strong>: RFE (Recursive Feature Elimination)</p></li>
<li><p><strong>Embedded methods</strong>: L1 regularization, feature importance z drzew</p></li>
</ul>
</section>
<section id="ekstrakcja-cech">
<h3>5. Ekstrakcja cech<a class="headerlink" href="#ekstrakcja-cech" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>PCA</strong>: Principal Component Analysis - redukcja wymiarowości</p>
<ul>
<li><p>PCA to technika redukcji wymiarowości, która przekształca dane do nowego układu współrzędnych, gdzie pierwsza składowa wyjaśnia maksymalną wariancję danych, druga składowa - maksymalną pozostałą wariancję prostopadłą do pierwszej, i tak dalej. Jest to metoda nienadzorowana - nie korzysta z informacji o klasach. PCA znajduje kierunki maksymalnej zmienności w danych i projektuje na nie punkty. Wykorzystywana jest głównie do kompresji danych, wizualizacji wysokowymiarowych zbiorów i usuwania skorelowanych cech. Nowe składowe (principal components) są liniowymi kombinacjami oryginalnych cech.</p></li>
</ul>
</li>
<li><p><strong>LDA</strong>: Linear Discriminant Analysis - dla klasyfikacji</p>
<ul>
<li><p>LDA to technika redukcji wymiarowości, która maksymalizuje separację między klasami, minimalizując jednocześnie rozrzut wewnątrz klas. W przeciwieństwie do PCA, LDA jest metodą nadzorowaną - wymaga informacji o przynależności do klas. LDA szuka projekcji, która maksymalizuje stosunek wariancji międzyklasowej do wariancji wewnątrzklasowej. Jest szczególnie przydatna w zadaniach klasyfikacji, gdzie chcemy wyraźnie oddzielić różne grupy. Maksymalna liczba składowych w LDA to liczba klas minus jeden.</p></li>
</ul>
</li>
<li><p><strong>Polynomial features</strong>: cechy wielomianowe</p>
<ul>
<li><p>“Polynomial features” to technika tworzenia nowych cech poprzez podnoszenie oryginalnych cech do wyższych potęg oraz tworzenie ich iloczynów (interakcji). Na przykład, z cech x₁ i x₂ możemy utworzyć: x₁², x₂², x₁·x₂, x₁³, x₂³, x₁²·x₂, x₁·x₂², itd. Umożliwia to modelom liniowym (jak regresja liniowa) uczenie się nieliniowych zależności w danych. Należy jednak uważać, bo liczba cech rośnie wykładniczo - dla n cech i stopnia d otrzymujemy O(nᵈ) nowych cech, co może prowadzić do przeuczenia. W praktyce często używa się stopnia 2 lub 3, rzadziej wyższych, i często w połączeniu z regularyzacją (Ridge, Lasso).</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="przyklad-1-klasyfikacja-kompleksowa-inzynieria-cech-dla-zbioru-ocalalych-z-katastrofy-titanica">
<h2>Przykład 1: Klasyfikacja - Kompleksowa inżynieria cech dla zbioru ocalałych z katastrofy Titanica<a class="headerlink" href="#przyklad-1-klasyfikacja-kompleksowa-inzynieria-cech-dla-zbioru-ocalalych-z-katastrofy-titanica" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">LabelEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">SelectKBest</span><span class="p">,</span> <span class="n">mutual_info_classif</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="c1"># Utworzenie syntetycznego zbioru danych podobnego do Titanica</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">n_samples</span> <span class="o">=</span> <span class="mi">800</span>

<span class="c1"># Generowanie danych syntetycznych</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Wiek&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span>
    <span class="s1">&#39;Cena&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">lognormal</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span>
    <span class="s1">&#39;Klasa&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">n_samples</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]),</span>
    <span class="s1">&#39;Plec&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;mezczyzna&#39;</span><span class="p">,</span> <span class="s1">&#39;kobieta&#39;</span><span class="p">],</span> <span class="n">n_samples</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">]),</span>
    <span class="s1">&#39;Rodzenstwo&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">n_samples</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">]),</span>
    <span class="s1">&#39;Rodzice&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">n_samples</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]),</span>
    <span class="s1">&#39;Port&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;Southampton&#39;</span><span class="p">,</span> <span class="s1">&#39;Cherbourg&#39;</span><span class="p">,</span> <span class="s1">&#39;Queenstown&#39;</span><span class="p">],</span> <span class="n">n_samples</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
<span class="p">})</span>
<span class="c1"># &#39;Port&#39; oznacza &#39;port zaokrętowania&#39;.</span>


<span class="c1"># Generowanie zmiennej docelowej z zależnościami</span>
<span class="n">survived_prob</span> <span class="o">=</span> <span class="p">(</span>
    <span class="mf">0.1</span> <span class="o">+</span>  <span class="c1"># baseline</span>
    <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Plec&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;kobieta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.4</span> <span class="o">+</span>  <span class="c1"># kobiety mają wyższą szansę</span>
    <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Klasa&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.3</span> <span class="o">+</span>  <span class="c1"># pierwsza klasa ma wyższą szansę</span>
    <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Wiek&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.2</span> <span class="o">+</span>  <span class="c1"># dzieci mają wyższą szansę</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">)</span>  <span class="c1"># szum</span>
<span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Przezycie&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">survived_prob</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DANE WEJŚCIOWE&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Rozmiar zbioru: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Pierwsze wiersze:</span><span class="se">\n</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Informacje o danych:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Rozkład klasy docelowej:</span><span class="se">\n</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Przezycie&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Brakujące wartości:</span><span class="se">\n</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Wprowadzenie kilku brakujących wartości</span>
<span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="s1">&#39;Wiek&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="s1">&#39;Cena&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Brakujące wartości po wprowadzeniu braków:</span><span class="se">\n</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Podział na X i y</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Przezycie&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Przezycie&#39;</span><span class="p">]</span>

<span class="c1"># Podział train-test</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INŻYNIERIA CECH - KROK PO KROKU&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>

<span class="c1"># KROK 1: Uzupełnienie brakujących wartości</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">KROK 1: Uzupełnienie brakujących wartości&quot;</span><span class="p">)</span>

<span class="n">X_train_fe</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">X_test_fe</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Uzupełnienie wieku medianą</span>
<span class="n">wiek_median</span> <span class="o">=</span> <span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;Wiek&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;Wiek&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">wiek_median</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;Wiek&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">wiek_median</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Uzupełnienie ceny medianą</span>
<span class="n">cena_median</span> <span class="o">=</span> <span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;Cena&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;Cena&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">cena_median</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;Cena&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">cena_median</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Uzupełniono Wiek medianą: </span><span class="si">{</span><span class="n">wiek_median</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Uzupełniono Cena medianą: </span><span class="si">{</span><span class="n">cena_median</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># KROK 2: Tworzenie nowych cech</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">KROK 2: Tworzenie nowych cech&quot;</span><span class="p">)</span>

<span class="c1"># RozmiarRodziny = Rodzenstwo + Rodzice + 1</span>
<span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;RozmiarRodziny&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;Rodzenstwo&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;Rodzice&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;RozmiarRodziny&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;Rodzenstwo&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;Rodzice&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c1"># CzySam - czy pasażer podróżuje sam</span>
<span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;CzySam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;RozmiarRodziny&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;CzySam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;RozmiarRodziny&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># GrupaWiekowa - grupowanie wieku</span>
<span class="k">def</span> <span class="nf">kategoryzuj_wiek</span><span class="p">(</span><span class="n">wiek</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">wiek</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;Dziecko&#39;</span>
    <span class="k">elif</span> <span class="n">wiek</span> <span class="o">&lt;</span> <span class="mi">18</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;Nastolatek&#39;</span>
    <span class="k">elif</span> <span class="n">wiek</span> <span class="o">&lt;</span> <span class="mi">65</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;Dorosly&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;Senior&#39;</span>

<span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;GrupaWiekowa&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;Wiek&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">kategoryzuj_wiek</span><span class="p">)</span>
<span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;GrupaWiekowa&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;Wiek&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">kategoryzuj_wiek</span><span class="p">)</span>

<span class="c1"># CenaNaOsobe - cena na osobę w rodzinie</span>
<span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;CenaNaOsobe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;Cena&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;RozmiarRodziny&#39;</span><span class="p">]</span>
<span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;CenaNaOsobe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;Cena&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;RozmiarRodziny&#39;</span><span class="p">]</span>

<span class="c1"># PrzedzialCeny - dyskretyzacja ceny biletu</span>
<span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;PrzedzialCeny&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;Cena&#39;</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Niska&#39;</span><span class="p">,</span> <span class="s1">&#39;Srednia&#39;</span><span class="p">,</span> <span class="s1">&#39;Wysoka&#39;</span><span class="p">,</span> <span class="s1">&#39;BardzoWysoka&#39;</span><span class="p">],</span> <span class="n">duplicates</span><span class="o">=</span><span class="s1">&#39;drop&#39;</span><span class="p">)</span>
<span class="c1"># Dla test używamy tych samych przedziałów co dla train</span>
<span class="n">cena_bins</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;Cena&#39;</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">retbins</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">duplicates</span><span class="o">=</span><span class="s1">&#39;drop&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;PrzedzialCeny&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;Cena&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">cena_bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Niska&#39;</span><span class="p">,</span> <span class="s1">&#39;Srednia&#39;</span><span class="p">,</span> <span class="s1">&#39;Wysoka&#39;</span><span class="p">,</span> <span class="s1">&#39;BardzoWysoka&#39;</span><span class="p">],</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Utworzono cechy:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    - RozmiarRodziny: liczba członków rodziny&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    - CzySam: czy pasażer sam&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    - GrupaWiekowa: kategoria wieku&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    - CenaNaOsobe: cena na osobę&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    - PrzedzialCeny: przedział cenowy&quot;</span><span class="p">)</span>

<span class="c1"># KROK 3: Kodowanie zmiennych kategorycznych</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">KROK 3: Kodowanie zmiennych kategorycznych&quot;</span><span class="p">)</span>

<span class="c1"># Label Encoding dla zmiennych ordinalnych</span>
<span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;Klasa_zakodowana&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;Klasa&#39;</span><span class="p">]</span>
<span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;Klasa_zakodowana&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;Klasa&#39;</span><span class="p">]</span>

<span class="c1"># One-Hot Encoding dla zmiennych nominalnych</span>
<span class="n">categorical_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Plec&#39;</span><span class="p">,</span> <span class="s1">&#39;Port&#39;</span><span class="p">,</span> <span class="s1">&#39;GrupaWiekowa&#39;</span><span class="p">,</span> <span class="s1">&#39;PrzedzialCeny&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">categorical_cols</span><span class="p">:</span>
    <span class="c1"># One-hot encoding</span>
    <span class="n">train_dummies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">X_train_fe</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">prefix</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">test_dummies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">X_test_fe</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">prefix</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Upewnij się, że test ma te same kolumny co train</span>
    <span class="k">for</span> <span class="n">col_dummy</span> <span class="ow">in</span> <span class="n">train_dummies</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">col_dummy</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">test_dummies</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">test_dummies</span><span class="p">[</span><span class="n">col_dummy</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">X_train_fe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_train_fe</span><span class="p">,</span> <span class="n">train_dummies</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">X_test_fe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_test_fe</span><span class="p">,</span> <span class="n">test_dummies</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Zakodowano </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">categorical_cols</span><span class="p">)</span><span class="si">}</span><span class="s2"> zmiennych kategorycznych&quot;</span><span class="p">)</span>

<span class="c1"># KROK 4: Interakcje cech</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">KROK 4: Tworzenie interakcji między cechami&quot;</span><span class="p">)</span>

<span class="c1"># Interakcja: Plec z Klasa</span>
<span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;Plec_Klasa&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;Plec_mezczyzna&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;Klasa_zakodowana&#39;</span><span class="p">])</span>
<span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;Plec_Klasa&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;Plec_mezczyzna&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;Klasa_zakodowana&#39;</span><span class="p">])</span>

<span class="c1"># Interakcja: Wiek z RozmiarRodziny</span>
<span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;Wiek_RozmiarRodziny&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;Wiek&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;RozmiarRodziny&#39;</span><span class="p">]</span>
<span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;Wiek_RozmiarRodziny&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;Wiek&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;RozmiarRodziny&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Utworzono interakcje: Plec_Klasa, Wiek_RozmiarRodziny&quot;</span><span class="p">)</span>

<span class="c1"># Usunięcie oryginalnych kolumn kategorycznych</span>
<span class="n">cols_to_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Plec&#39;</span><span class="p">,</span> <span class="s1">&#39;Port&#39;</span><span class="p">,</span> <span class="s1">&#39;GrupaWiekowa&#39;</span><span class="p">,</span> <span class="s1">&#39;PrzedzialCeny&#39;</span><span class="p">]</span>
<span class="n">X_train_fe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">cols_to_drop</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_test_fe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">cols_to_drop</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># KROK 5: Skalowanie cech numerycznych</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">KROK 5: Skalowanie cech numerycznych&quot;</span><span class="p">)</span>

<span class="n">numerical_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Wiek&#39;</span><span class="p">,</span> <span class="s1">&#39;Cena&#39;</span><span class="p">,</span> <span class="s1">&#39;CenaNaOsobe&#39;</span><span class="p">,</span> <span class="s1">&#39;Wiek_RozmiarRodziny&#39;</span><span class="p">]</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>

<span class="n">X_train_fe</span><span class="p">[</span><span class="n">numerical_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train_fe</span><span class="p">[</span><span class="n">numerical_cols</span><span class="p">])</span>
<span class="n">X_test_fe</span><span class="p">[</span><span class="n">numerical_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_fe</span><span class="p">[</span><span class="n">numerical_cols</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Przeskalowano </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">numerical_cols</span><span class="p">)</span><span class="si">}</span><span class="s2"> cech numerycznych&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Liczba cech po inżynierii: </span><span class="si">{</span><span class="n">X_train_fe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lista cech: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">X_train_fe</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># KROK 6: Selekcja cech - porównanie metod</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SELEKCJA CECH&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>

<span class="c1"># Metoda 1: SelectKBest z mutual information</span>
<span class="n">selector_mi</span> <span class="o">=</span> <span class="n">SelectKBest</span><span class="p">(</span><span class="n">mutual_info_classif</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">X_train_mi</span> <span class="o">=</span> <span class="n">selector_mi</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train_fe</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">X_test_mi</span> <span class="o">=</span> <span class="n">selector_mi</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_fe</span><span class="p">)</span>

<span class="n">selected_features_mi</span> <span class="o">=</span> <span class="n">X_train_fe</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">selector_mi</span><span class="o">.</span><span class="n">get_support</span><span class="p">()]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Metoda 1 - Mutual Information (top 10 cech):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">selected_features_mi</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Metoda 2: Feature importance z Random Forest</span>
<span class="n">rf_temp</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">rf_temp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_fe</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">feature_importance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;cecha&#39;</span><span class="p">:</span> <span class="n">X_train_fe</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
    <span class="s1">&#39;waznosc&#39;</span><span class="p">:</span> <span class="n">rf_temp</span><span class="o">.</span><span class="n">feature_importances_</span>
<span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;waznosc&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Metoda 2 - Feature Importance (Random Forest):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">feature_importance</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># Wizualizacja ważności cech</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">feature_importance</span><span class="p">[</span><span class="s1">&#39;cecha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">feature_importance</span><span class="p">[</span><span class="s1">&#39;waznosc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Ważność cechy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Top 10 najważniejszych cech (Random Forest)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># KROK 7: Porównanie modeli</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PORÓWNANIE MODELI&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>

<span class="n">models_comparison</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Model na surowych danych (tylko podstawowe kodowanie)</span>
<span class="n">X_train_basic</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">X_test_basic</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Podstawowe przetworzenie</span>
<span class="n">X_train_basic</span><span class="p">[</span><span class="s1">&#39;Wiek&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">X_train_basic</span><span class="p">[</span><span class="s1">&#39;Wiek&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_test_basic</span><span class="p">[</span><span class="s1">&#39;Wiek&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">X_train_basic</span><span class="p">[</span><span class="s1">&#39;Wiek&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_train_basic</span><span class="p">[</span><span class="s1">&#39;Cena&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">X_train_basic</span><span class="p">[</span><span class="s1">&#39;Cena&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_test_basic</span><span class="p">[</span><span class="s1">&#39;Cena&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">X_train_basic</span><span class="p">[</span><span class="s1">&#39;Cena&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">le</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Plec&#39;</span><span class="p">,</span> <span class="s1">&#39;Port&#39;</span><span class="p">]:</span>
    <span class="n">X_train_basic</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train_basic</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="n">X_test_basic</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_basic</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>

<span class="c1"># Model 1: Na podstawowych cechach</span>
<span class="n">lr_basic</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">scores_basic</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">lr_basic</span><span class="p">,</span> <span class="n">X_train_basic</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
<span class="n">models_comparison</span><span class="p">[</span><span class="s1">&#39;Podstawowe cechy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scores_basic</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Model na podstawowych cechach:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  CV Accuracy: </span><span class="si">{</span><span class="n">scores_basic</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (+/- </span><span class="si">{</span><span class="n">scores_basic</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># Model 2: Na cechach po inżynierii</span>
<span class="n">lr_fe</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">scores_fe</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">lr_fe</span><span class="p">,</span> <span class="n">X_train_fe</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
<span class="n">models_comparison</span><span class="p">[</span><span class="s1">&#39;Po inżynierii cech&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scores_fe</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Model po inżynierii cech:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  CV Accuracy: </span><span class="si">{</span><span class="n">scores_fe</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (+/- </span><span class="si">{</span><span class="n">scores_fe</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># Model 3: Po selekcji cech</span>
<span class="n">lr_selected</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">scores_selected</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">lr_selected</span><span class="p">,</span> <span class="n">X_train_mi</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
<span class="n">models_comparison</span><span class="p">[</span><span class="s1">&#39;Po selekcji cech&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scores_selected</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Model po selekcji cech:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  CV Accuracy: </span><span class="si">{</span><span class="n">scores_selected</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (+/- </span><span class="si">{</span><span class="n">scores_selected</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># Wykres porównania</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">models_comparison</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">models_comparison</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Wpływ inżynierii cech na wydajność modelu&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">models_comparison</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">v</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Finalna ocena na zbiorze testowym</span>
<span class="n">lr_fe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_fe</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">lr_fe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_fe</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FINALNA OCENA NA ZBIORZE TESTOWYM&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Raport klasyfikacji:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>

<span class="c1"># Macierz pomyłek</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Macierz pomyłek&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Prawdziwa klasa&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Przewidziana klasa&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Wnioski:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;UWAGA: W tym przypadku inżynieria cech POGORSZYŁA wyniki!&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- To normalne. Nie każda inżynieria cech &#39;działa&#39;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Zbyt wiele cech może prowadzić do przeuczenia&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Proste dane + prosty model często = najlepsze wyniki&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Zawsze należy sprawdzać wpływ nowych cech!&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- W praktyce trzeba testować różne ich kombinacje i wybrać najlepszą&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A module that was compiled using NumPy 1.x cannot be run in
NumPy 2.2.6 as it may crash. To support both 1.x and 2.x
versions of NumPy, modules must be compiled with NumPy 2.0.
Some module may need to rebuild instead e.g. with &#39;pybind11&gt;=2.12&#39;.

If you are a user of the module, the easiest solution will be to
downgrade to &#39;numpy&lt;2&#39; or try to upgrade the affected module.
We expect that some modules will need time to support NumPy 2.

Traceback (most recent call last):  File &quot;&lt;frozen runpy&gt;&quot;, line 198, in _run_module_as_main
  File &quot;&lt;frozen runpy&gt;&quot;, line 88, in _run_code
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel_launcher.py&quot;, line 17, in &lt;module&gt;
    app.launch_new_instance()
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/traitlets/config/application.py&quot;, line 1075, in launch_instance
    app.start()
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelapp.py&quot;, line 701, in start
    self.io_loop.start()
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/tornado/platform/asyncio.py&quot;, line 205, in start
    self.asyncio_loop.run_forever()
  File &quot;/home/maciej/anaconda3/lib/python3.12/asyncio/base_events.py&quot;, line 639, in run_forever
    self._run_once()
  File &quot;/home/maciej/anaconda3/lib/python3.12/asyncio/base_events.py&quot;, line 1985, in _run_once
    handle._run()
  File &quot;/home/maciej/anaconda3/lib/python3.12/asyncio/events.py&quot;, line 88, in _run
    self._context.run(self._callback, *self._args)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelbase.py&quot;, line 534, in dispatch_queue
    await self.process_one()
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelbase.py&quot;, line 523, in process_one
    await dispatch(*args)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelbase.py&quot;, line 429, in dispatch_shell
    await result
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelbase.py&quot;, line 767, in execute_request
    reply_content = await reply_content
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/ipkernel.py&quot;, line 429, in do_execute
    res = shell.run_cell(
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/zmqshell.py&quot;, line 549, in run_cell
    return super().run_cell(*args, **kwargs)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3075, in run_cell
    result = self._run_cell(
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3130, in _run_cell
    result = runner(coro)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/async_helpers.py&quot;, line 128, in _pseudo_sync_runner
    coro.send(None)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3334, in run_cell_async
    has_raised = await self.run_ast_nodes(code_ast.body, cell_name,
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3517, in run_ast_nodes
    if await self.run_code(code, result, async_=asy):
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3577, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)
  File &quot;/tmp/ipykernel_16830/286114223.py&quot;, line 2, in &lt;module&gt;
    import pandas as pd
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/__init__.py&quot;, line 26, in &lt;module&gt;
    from pandas.compat import (
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/compat/__init__.py&quot;, line 29, in &lt;module&gt;
    from pandas.compat.pyarrow import (
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/compat/pyarrow.py&quot;, line 8, in &lt;module&gt;
    import pyarrow as pa
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pyarrow/__init__.py&quot;, line 65, in &lt;module&gt;
    import pyarrow.lib as _lib
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ImportError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="nn">File ~/anaconda3/lib/python3.12/site-packages/numpy/core/_multiarray_umath.py:44,</span> in <span class="ni">__getattr__</span><span class="nt">(attr_name)</span>
<span class="g g-Whitespace">     </span><span class="mi">39</span>     <span class="c1"># Also print the message (with traceback).  This is because old versions</span>
<span class="g g-Whitespace">     </span><span class="mi">40</span>     <span class="c1"># of NumPy unfortunately set up the import to replace (and hide) the</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span>     <span class="c1"># error.  The traceback shouldn&#39;t be needed, but e.g. pytest plugins</span>
<span class="g g-Whitespace">     </span><span class="mi">42</span>     <span class="c1"># seem to swallow it and we should be failing anyway...</span>
<span class="g g-Whitespace">     </span><span class="mi">43</span>     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">tb_msg</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">44</span>     <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span> <span class="n">ret</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_multiarray_umath</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span> <span class="k">if</span> <span class="n">ret</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

<span class="ne">ImportError</span>: 
<span class="n">A</span> <span class="n">module</span> <span class="n">that</span> <span class="n">was</span> <span class="n">compiled</span> <span class="n">using</span> <span class="n">NumPy</span> <span class="mf">1.</span><span class="n">x</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">run</span> <span class="ow">in</span>
<span class="n">NumPy</span> <span class="mf">2.2.6</span> <span class="k">as</span> <span class="n">it</span> <span class="n">may</span> <span class="n">crash</span><span class="o">.</span> <span class="n">To</span> <span class="n">support</span> <span class="n">both</span> <span class="mf">1.</span><span class="n">x</span> <span class="ow">and</span> <span class="mf">2.</span><span class="n">x</span>
<span class="n">versions</span> <span class="n">of</span> <span class="n">NumPy</span><span class="p">,</span> <span class="n">modules</span> <span class="n">must</span> <span class="n">be</span> <span class="n">compiled</span> <span class="k">with</span> <span class="n">NumPy</span> <span class="mf">2.0</span><span class="o">.</span>
<span class="n">Some</span> <span class="n">module</span> <span class="n">may</span> <span class="n">need</span> <span class="n">to</span> <span class="n">rebuild</span> <span class="n">instead</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="k">with</span> <span class="s1">&#39;pybind11&gt;=2.12&#39;</span><span class="o">.</span>

<span class="n">If</span> <span class="n">you</span> <span class="n">are</span> <span class="n">a</span> <span class="n">user</span> <span class="n">of</span> <span class="n">the</span> <span class="n">module</span><span class="p">,</span> <span class="n">the</span> <span class="n">easiest</span> <span class="n">solution</span> <span class="n">will</span> <span class="n">be</span> <span class="n">to</span>
<span class="n">downgrade</span> <span class="n">to</span> <span class="s1">&#39;numpy&lt;2&#39;</span> <span class="ow">or</span> <span class="k">try</span> <span class="n">to</span> <span class="n">upgrade</span> <span class="n">the</span> <span class="n">affected</span> <span class="n">module</span><span class="o">.</span>
<span class="n">We</span> <span class="n">expect</span> <span class="n">that</span> <span class="n">some</span> <span class="n">modules</span> <span class="n">will</span> <span class="n">need</span> <span class="n">time</span> <span class="n">to</span> <span class="n">support</span> <span class="n">NumPy</span> <span class="mf">2.</span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A module that was compiled using NumPy 1.x cannot be run in
NumPy 2.2.6 as it may crash. To support both 1.x and 2.x
versions of NumPy, modules must be compiled with NumPy 2.0.
Some module may need to rebuild instead e.g. with &#39;pybind11&gt;=2.12&#39;.

If you are a user of the module, the easiest solution will be to
downgrade to &#39;numpy&lt;2&#39; or try to upgrade the affected module.
We expect that some modules will need time to support NumPy 2.

Traceback (most recent call last):  File &quot;&lt;frozen runpy&gt;&quot;, line 198, in _run_module_as_main
  File &quot;&lt;frozen runpy&gt;&quot;, line 88, in _run_code
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel_launcher.py&quot;, line 17, in &lt;module&gt;
    app.launch_new_instance()
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/traitlets/config/application.py&quot;, line 1075, in launch_instance
    app.start()
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelapp.py&quot;, line 701, in start
    self.io_loop.start()
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/tornado/platform/asyncio.py&quot;, line 205, in start
    self.asyncio_loop.run_forever()
  File &quot;/home/maciej/anaconda3/lib/python3.12/asyncio/base_events.py&quot;, line 639, in run_forever
    self._run_once()
  File &quot;/home/maciej/anaconda3/lib/python3.12/asyncio/base_events.py&quot;, line 1985, in _run_once
    handle._run()
  File &quot;/home/maciej/anaconda3/lib/python3.12/asyncio/events.py&quot;, line 88, in _run
    self._context.run(self._callback, *self._args)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelbase.py&quot;, line 534, in dispatch_queue
    await self.process_one()
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelbase.py&quot;, line 523, in process_one
    await dispatch(*args)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelbase.py&quot;, line 429, in dispatch_shell
    await result
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelbase.py&quot;, line 767, in execute_request
    reply_content = await reply_content
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/ipkernel.py&quot;, line 429, in do_execute
    res = shell.run_cell(
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/zmqshell.py&quot;, line 549, in run_cell
    return super().run_cell(*args, **kwargs)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3075, in run_cell
    result = self._run_cell(
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3130, in _run_cell
    result = runner(coro)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/async_helpers.py&quot;, line 128, in _pseudo_sync_runner
    coro.send(None)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3334, in run_cell_async
    has_raised = await self.run_ast_nodes(code_ast.body, cell_name,
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3517, in run_ast_nodes
    if await self.run_code(code, result, async_=asy):
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3577, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)
  File &quot;/tmp/ipykernel_16830/286114223.py&quot;, line 2, in &lt;module&gt;
    import pandas as pd
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/__init__.py&quot;, line 49, in &lt;module&gt;
    from pandas.core.api import (
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/core/api.py&quot;, line 9, in &lt;module&gt;
    from pandas.core.dtypes.dtypes import (
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/core/dtypes/dtypes.py&quot;, line 24, in &lt;module&gt;
    from pandas._libs import (
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pyarrow/__init__.py&quot;, line 65, in &lt;module&gt;
    import pyarrow.lib as _lib
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ImportError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="nn">File ~/anaconda3/lib/python3.12/site-packages/numpy/core/_multiarray_umath.py:44,</span> in <span class="ni">__getattr__</span><span class="nt">(attr_name)</span>
<span class="g g-Whitespace">     </span><span class="mi">39</span>     <span class="c1"># Also print the message (with traceback).  This is because old versions</span>
<span class="g g-Whitespace">     </span><span class="mi">40</span>     <span class="c1"># of NumPy unfortunately set up the import to replace (and hide) the</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span>     <span class="c1"># error.  The traceback shouldn&#39;t be needed, but e.g. pytest plugins</span>
<span class="g g-Whitespace">     </span><span class="mi">42</span>     <span class="c1"># seem to swallow it and we should be failing anyway...</span>
<span class="g g-Whitespace">     </span><span class="mi">43</span>     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">tb_msg</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">44</span>     <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span> <span class="n">ret</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_multiarray_umath</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span> <span class="k">if</span> <span class="n">ret</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

<span class="ne">ImportError</span>: 
<span class="n">A</span> <span class="n">module</span> <span class="n">that</span> <span class="n">was</span> <span class="n">compiled</span> <span class="n">using</span> <span class="n">NumPy</span> <span class="mf">1.</span><span class="n">x</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">run</span> <span class="ow">in</span>
<span class="n">NumPy</span> <span class="mf">2.2.6</span> <span class="k">as</span> <span class="n">it</span> <span class="n">may</span> <span class="n">crash</span><span class="o">.</span> <span class="n">To</span> <span class="n">support</span> <span class="n">both</span> <span class="mf">1.</span><span class="n">x</span> <span class="ow">and</span> <span class="mf">2.</span><span class="n">x</span>
<span class="n">versions</span> <span class="n">of</span> <span class="n">NumPy</span><span class="p">,</span> <span class="n">modules</span> <span class="n">must</span> <span class="n">be</span> <span class="n">compiled</span> <span class="k">with</span> <span class="n">NumPy</span> <span class="mf">2.0</span><span class="o">.</span>
<span class="n">Some</span> <span class="n">module</span> <span class="n">may</span> <span class="n">need</span> <span class="n">to</span> <span class="n">rebuild</span> <span class="n">instead</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="k">with</span> <span class="s1">&#39;pybind11&gt;=2.12&#39;</span><span class="o">.</span>

<span class="n">If</span> <span class="n">you</span> <span class="n">are</span> <span class="n">a</span> <span class="n">user</span> <span class="n">of</span> <span class="n">the</span> <span class="n">module</span><span class="p">,</span> <span class="n">the</span> <span class="n">easiest</span> <span class="n">solution</span> <span class="n">will</span> <span class="n">be</span> <span class="n">to</span>
<span class="n">downgrade</span> <span class="n">to</span> <span class="s1">&#39;numpy&lt;2&#39;</span> <span class="ow">or</span> <span class="k">try</span> <span class="n">to</span> <span class="n">upgrade</span> <span class="n">the</span> <span class="n">affected</span> <span class="n">module</span><span class="o">.</span>
<span class="n">We</span> <span class="n">expect</span> <span class="n">that</span> <span class="n">some</span> <span class="n">modules</span> <span class="n">will</span> <span class="n">need</span> <span class="n">time</span> <span class="n">to</span> <span class="n">support</span> <span class="n">NumPy</span> <span class="mf">2.</span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A module that was compiled using NumPy 1.x cannot be run in
NumPy 2.2.6 as it may crash. To support both 1.x and 2.x
versions of NumPy, modules must be compiled with NumPy 2.0.
Some module may need to rebuild instead e.g. with &#39;pybind11&gt;=2.12&#39;.

If you are a user of the module, the easiest solution will be to
downgrade to &#39;numpy&lt;2&#39; or try to upgrade the affected module.
We expect that some modules will need time to support NumPy 2.

Traceback (most recent call last):  File &quot;&lt;frozen runpy&gt;&quot;, line 198, in _run_module_as_main
  File &quot;&lt;frozen runpy&gt;&quot;, line 88, in _run_code
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel_launcher.py&quot;, line 17, in &lt;module&gt;
    app.launch_new_instance()
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/traitlets/config/application.py&quot;, line 1075, in launch_instance
    app.start()
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelapp.py&quot;, line 701, in start
    self.io_loop.start()
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/tornado/platform/asyncio.py&quot;, line 205, in start
    self.asyncio_loop.run_forever()
  File &quot;/home/maciej/anaconda3/lib/python3.12/asyncio/base_events.py&quot;, line 639, in run_forever
    self._run_once()
  File &quot;/home/maciej/anaconda3/lib/python3.12/asyncio/base_events.py&quot;, line 1985, in _run_once
    handle._run()
  File &quot;/home/maciej/anaconda3/lib/python3.12/asyncio/events.py&quot;, line 88, in _run
    self._context.run(self._callback, *self._args)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelbase.py&quot;, line 534, in dispatch_queue
    await self.process_one()
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelbase.py&quot;, line 523, in process_one
    await dispatch(*args)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelbase.py&quot;, line 429, in dispatch_shell
    await result
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelbase.py&quot;, line 767, in execute_request
    reply_content = await reply_content
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/ipkernel.py&quot;, line 429, in do_execute
    res = shell.run_cell(
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/zmqshell.py&quot;, line 549, in run_cell
    return super().run_cell(*args, **kwargs)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3075, in run_cell
    result = self._run_cell(
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3130, in _run_cell
    result = runner(coro)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/async_helpers.py&quot;, line 128, in _pseudo_sync_runner
    coro.send(None)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3334, in run_cell_async
    has_raised = await self.run_ast_nodes(code_ast.body, cell_name,
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3517, in run_ast_nodes
    if await self.run_code(code, result, async_=asy):
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3577, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)
  File &quot;/tmp/ipykernel_16830/286114223.py&quot;, line 2, in &lt;module&gt;
    import pandas as pd
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/__init__.py&quot;, line 49, in &lt;module&gt;
    from pandas.core.api import (
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/core/api.py&quot;, line 28, in &lt;module&gt;
    from pandas.core.arrays import Categorical
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/core/arrays/__init__.py&quot;, line 1, in &lt;module&gt;
    from pandas.core.arrays.arrow import ArrowExtensionArray
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/core/arrays/arrow/__init__.py&quot;, line 5, in &lt;module&gt;
    from pandas.core.arrays.arrow.array import ArrowExtensionArray
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/core/arrays/arrow/array.py&quot;, line 53, in &lt;module&gt;
    from pandas.core import (
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/core/ops/__init__.py&quot;, line 8, in &lt;module&gt;
    from pandas.core.ops.array_ops import (
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/core/ops/array_ops.py&quot;, line 56, in &lt;module&gt;
    from pandas.core.computation import expressions
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/core/computation/expressions.py&quot;, line 21, in &lt;module&gt;
    from pandas.core.computation.check import NUMEXPR_INSTALLED
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/core/computation/check.py&quot;, line 5, in &lt;module&gt;
    ne = import_optional_dependency(&quot;numexpr&quot;, errors=&quot;warn&quot;)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/compat/_optional.py&quot;, line 135, in import_optional_dependency
    module = importlib.import_module(name)
  File &quot;/home/maciej/anaconda3/lib/python3.12/importlib/__init__.py&quot;, line 90, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/numexpr/__init__.py&quot;, line 24, in &lt;module&gt;
    from numexpr.interpreter import MAX_THREADS, use_vml, __BLOCK_SIZE1__
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="ne">AttributeError</span>: _ARRAY_API not found
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A module that was compiled using NumPy 1.x cannot be run in
NumPy 2.2.6 as it may crash. To support both 1.x and 2.x
versions of NumPy, modules must be compiled with NumPy 2.0.
Some module may need to rebuild instead e.g. with &#39;pybind11&gt;=2.12&#39;.

If you are a user of the module, the easiest solution will be to
downgrade to &#39;numpy&lt;2&#39; or try to upgrade the affected module.
We expect that some modules will need time to support NumPy 2.

Traceback (most recent call last):  File &quot;&lt;frozen runpy&gt;&quot;, line 198, in _run_module_as_main
  File &quot;&lt;frozen runpy&gt;&quot;, line 88, in _run_code
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel_launcher.py&quot;, line 17, in &lt;module&gt;
    app.launch_new_instance()
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/traitlets/config/application.py&quot;, line 1075, in launch_instance
    app.start()
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelapp.py&quot;, line 701, in start
    self.io_loop.start()
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/tornado/platform/asyncio.py&quot;, line 205, in start
    self.asyncio_loop.run_forever()
  File &quot;/home/maciej/anaconda3/lib/python3.12/asyncio/base_events.py&quot;, line 639, in run_forever
    self._run_once()
  File &quot;/home/maciej/anaconda3/lib/python3.12/asyncio/base_events.py&quot;, line 1985, in _run_once
    handle._run()
  File &quot;/home/maciej/anaconda3/lib/python3.12/asyncio/events.py&quot;, line 88, in _run
    self._context.run(self._callback, *self._args)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelbase.py&quot;, line 534, in dispatch_queue
    await self.process_one()
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelbase.py&quot;, line 523, in process_one
    await dispatch(*args)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelbase.py&quot;, line 429, in dispatch_shell
    await result
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelbase.py&quot;, line 767, in execute_request
    reply_content = await reply_content
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/ipkernel.py&quot;, line 429, in do_execute
    res = shell.run_cell(
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/zmqshell.py&quot;, line 549, in run_cell
    return super().run_cell(*args, **kwargs)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3075, in run_cell
    result = self._run_cell(
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3130, in _run_cell
    result = runner(coro)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/async_helpers.py&quot;, line 128, in _pseudo_sync_runner
    coro.send(None)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3334, in run_cell_async
    has_raised = await self.run_ast_nodes(code_ast.body, cell_name,
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3517, in run_ast_nodes
    if await self.run_code(code, result, async_=asy):
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3577, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)
  File &quot;/tmp/ipykernel_16830/286114223.py&quot;, line 2, in &lt;module&gt;
    import pandas as pd
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/__init__.py&quot;, line 49, in &lt;module&gt;
    from pandas.core.api import (
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/core/api.py&quot;, line 28, in &lt;module&gt;
    from pandas.core.arrays import Categorical
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/core/arrays/__init__.py&quot;, line 1, in &lt;module&gt;
    from pandas.core.arrays.arrow import ArrowExtensionArray
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/core/arrays/arrow/__init__.py&quot;, line 5, in &lt;module&gt;
    from pandas.core.arrays.arrow.array import ArrowExtensionArray
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/core/arrays/arrow/array.py&quot;, line 67, in &lt;module&gt;
    from pandas.core.arrays.masked import BaseMaskedArray
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/core/arrays/masked.py&quot;, line 61, in &lt;module&gt;
    from pandas.core import (
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/core/nanops.py&quot;, line 52, in &lt;module&gt;
    bn = import_optional_dependency(&quot;bottleneck&quot;, errors=&quot;warn&quot;)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/pandas/compat/_optional.py&quot;, line 135, in import_optional_dependency
    module = importlib.import_module(name)
  File &quot;/home/maciej/anaconda3/lib/python3.12/importlib/__init__.py&quot;, line 90, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/bottleneck/__init__.py&quot;, line 7, in &lt;module&gt;
    from .move import (move_argmax, move_argmin, move_max, move_mean, move_median,
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ImportError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="nn">File ~/anaconda3/lib/python3.12/site-packages/numpy/core/_multiarray_umath.py:44,</span> in <span class="ni">__getattr__</span><span class="nt">(attr_name)</span>
<span class="g g-Whitespace">     </span><span class="mi">39</span>     <span class="c1"># Also print the message (with traceback).  This is because old versions</span>
<span class="g g-Whitespace">     </span><span class="mi">40</span>     <span class="c1"># of NumPy unfortunately set up the import to replace (and hide) the</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span>     <span class="c1"># error.  The traceback shouldn&#39;t be needed, but e.g. pytest plugins</span>
<span class="g g-Whitespace">     </span><span class="mi">42</span>     <span class="c1"># seem to swallow it and we should be failing anyway...</span>
<span class="g g-Whitespace">     </span><span class="mi">43</span>     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">tb_msg</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">44</span>     <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span> <span class="n">ret</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_multiarray_umath</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span> <span class="k">if</span> <span class="n">ret</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

<span class="ne">ImportError</span>: 
<span class="n">A</span> <span class="n">module</span> <span class="n">that</span> <span class="n">was</span> <span class="n">compiled</span> <span class="n">using</span> <span class="n">NumPy</span> <span class="mf">1.</span><span class="n">x</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">run</span> <span class="ow">in</span>
<span class="n">NumPy</span> <span class="mf">2.2.6</span> <span class="k">as</span> <span class="n">it</span> <span class="n">may</span> <span class="n">crash</span><span class="o">.</span> <span class="n">To</span> <span class="n">support</span> <span class="n">both</span> <span class="mf">1.</span><span class="n">x</span> <span class="ow">and</span> <span class="mf">2.</span><span class="n">x</span>
<span class="n">versions</span> <span class="n">of</span> <span class="n">NumPy</span><span class="p">,</span> <span class="n">modules</span> <span class="n">must</span> <span class="n">be</span> <span class="n">compiled</span> <span class="k">with</span> <span class="n">NumPy</span> <span class="mf">2.0</span><span class="o">.</span>
<span class="n">Some</span> <span class="n">module</span> <span class="n">may</span> <span class="n">need</span> <span class="n">to</span> <span class="n">rebuild</span> <span class="n">instead</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="k">with</span> <span class="s1">&#39;pybind11&gt;=2.12&#39;</span><span class="o">.</span>

<span class="n">If</span> <span class="n">you</span> <span class="n">are</span> <span class="n">a</span> <span class="n">user</span> <span class="n">of</span> <span class="n">the</span> <span class="n">module</span><span class="p">,</span> <span class="n">the</span> <span class="n">easiest</span> <span class="n">solution</span> <span class="n">will</span> <span class="n">be</span> <span class="n">to</span>
<span class="n">downgrade</span> <span class="n">to</span> <span class="s1">&#39;numpy&lt;2&#39;</span> <span class="ow">or</span> <span class="k">try</span> <span class="n">to</span> <span class="n">upgrade</span> <span class="n">the</span> <span class="n">affected</span> <span class="n">module</span><span class="o">.</span>
<span class="n">We</span> <span class="n">expect</span> <span class="n">that</span> <span class="n">some</span> <span class="n">modules</span> <span class="n">will</span> <span class="n">need</span> <span class="n">time</span> <span class="n">to</span> <span class="n">support</span> <span class="n">NumPy</span> <span class="mf">2.</span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A module that was compiled using NumPy 1.x cannot be run in
NumPy 2.2.6 as it may crash. To support both 1.x and 2.x
versions of NumPy, modules must be compiled with NumPy 2.0.
Some module may need to rebuild instead e.g. with &#39;pybind11&gt;=2.12&#39;.

If you are a user of the module, the easiest solution will be to
downgrade to &#39;numpy&lt;2&#39; or try to upgrade the affected module.
We expect that some modules will need time to support NumPy 2.

Traceback (most recent call last):  File &quot;&lt;frozen runpy&gt;&quot;, line 198, in _run_module_as_main
  File &quot;&lt;frozen runpy&gt;&quot;, line 88, in _run_code
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel_launcher.py&quot;, line 17, in &lt;module&gt;
    app.launch_new_instance()
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/traitlets/config/application.py&quot;, line 1075, in launch_instance
    app.start()
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelapp.py&quot;, line 701, in start
    self.io_loop.start()
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/tornado/platform/asyncio.py&quot;, line 205, in start
    self.asyncio_loop.run_forever()
  File &quot;/home/maciej/anaconda3/lib/python3.12/asyncio/base_events.py&quot;, line 639, in run_forever
    self._run_once()
  File &quot;/home/maciej/anaconda3/lib/python3.12/asyncio/base_events.py&quot;, line 1985, in _run_once
    handle._run()
  File &quot;/home/maciej/anaconda3/lib/python3.12/asyncio/events.py&quot;, line 88, in _run
    self._context.run(self._callback, *self._args)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelbase.py&quot;, line 534, in dispatch_queue
    await self.process_one()
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelbase.py&quot;, line 523, in process_one
    await dispatch(*args)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelbase.py&quot;, line 429, in dispatch_shell
    await result
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/kernelbase.py&quot;, line 767, in execute_request
    reply_content = await reply_content
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/ipkernel.py&quot;, line 429, in do_execute
    res = shell.run_cell(
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/ipykernel/zmqshell.py&quot;, line 549, in run_cell
    return super().run_cell(*args, **kwargs)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3075, in run_cell
    result = self._run_cell(
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3130, in _run_cell
    result = runner(coro)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/async_helpers.py&quot;, line 128, in _pseudo_sync_runner
    coro.send(None)
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3334, in run_cell_async
    has_raised = await self.run_ast_nodes(code_ast.body, cell_name,
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3517, in run_ast_nodes
    if await self.run_code(code, result, async_=asy):
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/IPython/core/interactiveshell.py&quot;, line 3577, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)
  File &quot;/tmp/ipykernel_16830/286114223.py&quot;, line 3, in &lt;module&gt;
    import matplotlib.pyplot as plt
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/matplotlib/__init__.py&quot;, line 159, in &lt;module&gt;
    from . import _api, _version, cbook, _docstring, rcsetup
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/matplotlib/rcsetup.py&quot;, line 28, in &lt;module&gt;
    from matplotlib.colors import Colormap, is_color_like
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/matplotlib/colors.py&quot;, line 57, in &lt;module&gt;
    from matplotlib import _api, _cm, cbook, scale
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/matplotlib/scale.py&quot;, line 22, in &lt;module&gt;
    from matplotlib.ticker import (
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/matplotlib/ticker.py&quot;, line 144, in &lt;module&gt;
    from matplotlib import transforms as mtransforms
  File &quot;/home/maciej/anaconda3/lib/python3.12/site-packages/matplotlib/transforms.py&quot;, line 49, in &lt;module&gt;
    from matplotlib._path import (
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ImportError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="nn">File ~/anaconda3/lib/python3.12/site-packages/numpy/core/_multiarray_umath.py:44,</span> in <span class="ni">__getattr__</span><span class="nt">(attr_name)</span>
<span class="g g-Whitespace">     </span><span class="mi">39</span>     <span class="c1"># Also print the message (with traceback).  This is because old versions</span>
<span class="g g-Whitespace">     </span><span class="mi">40</span>     <span class="c1"># of NumPy unfortunately set up the import to replace (and hide) the</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span>     <span class="c1"># error.  The traceback shouldn&#39;t be needed, but e.g. pytest plugins</span>
<span class="g g-Whitespace">     </span><span class="mi">42</span>     <span class="c1"># seem to swallow it and we should be failing anyway...</span>
<span class="g g-Whitespace">     </span><span class="mi">43</span>     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">tb_msg</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">44</span>     <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span> <span class="n">ret</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_multiarray_umath</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span> <span class="k">if</span> <span class="n">ret</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

<span class="ne">ImportError</span>: 
<span class="n">A</span> <span class="n">module</span> <span class="n">that</span> <span class="n">was</span> <span class="n">compiled</span> <span class="n">using</span> <span class="n">NumPy</span> <span class="mf">1.</span><span class="n">x</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">run</span> <span class="ow">in</span>
<span class="n">NumPy</span> <span class="mf">2.2.6</span> <span class="k">as</span> <span class="n">it</span> <span class="n">may</span> <span class="n">crash</span><span class="o">.</span> <span class="n">To</span> <span class="n">support</span> <span class="n">both</span> <span class="mf">1.</span><span class="n">x</span> <span class="ow">and</span> <span class="mf">2.</span><span class="n">x</span>
<span class="n">versions</span> <span class="n">of</span> <span class="n">NumPy</span><span class="p">,</span> <span class="n">modules</span> <span class="n">must</span> <span class="n">be</span> <span class="n">compiled</span> <span class="k">with</span> <span class="n">NumPy</span> <span class="mf">2.0</span><span class="o">.</span>
<span class="n">Some</span> <span class="n">module</span> <span class="n">may</span> <span class="n">need</span> <span class="n">to</span> <span class="n">rebuild</span> <span class="n">instead</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="k">with</span> <span class="s1">&#39;pybind11&gt;=2.12&#39;</span><span class="o">.</span>

<span class="n">If</span> <span class="n">you</span> <span class="n">are</span> <span class="n">a</span> <span class="n">user</span> <span class="n">of</span> <span class="n">the</span> <span class="n">module</span><span class="p">,</span> <span class="n">the</span> <span class="n">easiest</span> <span class="n">solution</span> <span class="n">will</span> <span class="n">be</span> <span class="n">to</span>
<span class="n">downgrade</span> <span class="n">to</span> <span class="s1">&#39;numpy&lt;2&#39;</span> <span class="ow">or</span> <span class="k">try</span> <span class="n">to</span> <span class="n">upgrade</span> <span class="n">the</span> <span class="n">affected</span> <span class="n">module</span><span class="o">.</span>
<span class="n">We</span> <span class="n">expect</span> <span class="n">that</span> <span class="n">some</span> <span class="n">modules</span> <span class="n">will</span> <span class="n">need</span> <span class="n">time</span> <span class="n">to</span> <span class="n">support</span> <span class="n">NumPy</span> <span class="mf">2.</span>
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ImportError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="ne">ImportError</span>: numpy.core.multiarray failed to import

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">ImportError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">cross_val_score</span>

<span class="n">File</span> <span class="o">~/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.12</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">matplotlib</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">159</span>
<span class="g g-Whitespace">    </span><span class="mi">155</span> <span class="kn">from</span> <span class="nn">packaging.version</span> <span class="kn">import</span> <span class="n">parse</span> <span class="k">as</span> <span class="n">parse_version</span>
<span class="g g-Whitespace">    </span><span class="mi">157</span> <span class="c1"># cbook must import matplotlib only within function</span>
<span class="g g-Whitespace">    </span><span class="mi">158</span> <span class="c1"># definitions, so it is safe to import from it here.</span>
<span class="ne">--&gt; </span><span class="mi">159</span> <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_api</span><span class="p">,</span> <span class="n">_version</span><span class="p">,</span> <span class="n">cbook</span><span class="p">,</span> <span class="n">_docstring</span><span class="p">,</span> <span class="n">rcsetup</span>
<span class="g g-Whitespace">    </span><span class="mi">160</span> <span class="kn">from</span> <span class="nn">matplotlib.cbook</span> <span class="kn">import</span> <span class="n">sanitize_sequence</span>
<span class="g g-Whitespace">    </span><span class="mi">161</span> <span class="kn">from</span> <span class="nn">matplotlib._api</span> <span class="kn">import</span> <span class="n">MatplotlibDeprecationWarning</span>

<span class="n">File</span> <span class="o">~/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.12</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">matplotlib</span><span class="o">/</span><span class="n">rcsetup</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">28</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span> <span class="kn">from</span> <span class="nn">matplotlib.backends</span> <span class="kn">import</span> <span class="n">BackendFilter</span><span class="p">,</span> <span class="n">backend_registry</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> <span class="kn">from</span> <span class="nn">matplotlib.cbook</span> <span class="kn">import</span> <span class="n">ls_mapper</span>
<span class="ne">---&gt; </span><span class="mi">28</span> <span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">Colormap</span><span class="p">,</span> <span class="n">is_color_like</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span> <span class="kn">from</span> <span class="nn">matplotlib._fontconfig_pattern</span> <span class="kn">import</span> <span class="n">parse_fontconfig_pattern</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span> <span class="kn">from</span> <span class="nn">matplotlib._enums</span> <span class="kn">import</span> <span class="n">JoinStyle</span><span class="p">,</span> <span class="n">CapStyle</span>

<span class="n">File</span> <span class="o">~/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.12</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">matplotlib</span><span class="o">/</span><span class="n">colors</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">57</span>
<span class="g g-Whitespace">     </span><span class="mi">55</span> <span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="ne">---&gt; </span><span class="mi">57</span> <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">_api</span><span class="p">,</span> <span class="n">_cm</span><span class="p">,</span> <span class="n">cbook</span><span class="p">,</span> <span class="n">scale</span>
<span class="g g-Whitespace">     </span><span class="mi">58</span> <span class="kn">from</span> <span class="nn">._color_data</span> <span class="kn">import</span> <span class="n">BASE_COLORS</span><span class="p">,</span> <span class="n">TABLEAU_COLORS</span><span class="p">,</span> <span class="n">CSS4_COLORS</span><span class="p">,</span> <span class="n">XKCD_COLORS</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span> <span class="k">class</span> <span class="nc">_ColorMapping</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>

<span class="n">File</span> <span class="o">~/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.12</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">matplotlib</span><span class="o">/</span><span class="n">scale</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">22</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span> <span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">_api</span><span class="p">,</span> <span class="n">_docstring</span>
<span class="ne">---&gt; </span><span class="mi">22</span> <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span>     <span class="n">NullFormatter</span><span class="p">,</span> <span class="n">ScalarFormatter</span><span class="p">,</span> <span class="n">LogFormatterSciNotation</span><span class="p">,</span> <span class="n">LogitFormatter</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span>     <span class="n">NullLocator</span><span class="p">,</span> <span class="n">LogLocator</span><span class="p">,</span> <span class="n">AutoLocator</span><span class="p">,</span> <span class="n">AutoMinorLocator</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span>     <span class="n">SymmetricalLogLocator</span><span class="p">,</span> <span class="n">AsinhLocator</span><span class="p">,</span> <span class="n">LogitLocator</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span> <span class="kn">from</span> <span class="nn">matplotlib.transforms</span> <span class="kn">import</span> <span class="n">Transform</span><span class="p">,</span> <span class="n">IdentityTransform</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span> <span class="k">class</span> <span class="nc">ScaleBase</span><span class="p">:</span>

<span class="n">File</span> <span class="o">~/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.12</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">matplotlib</span><span class="o">/</span><span class="n">ticker</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">144</span>
<span class="g g-Whitespace">    </span><span class="mi">142</span> <span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="g g-Whitespace">    </span><span class="mi">143</span> <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">_api</span><span class="p">,</span> <span class="n">cbook</span>
<span class="ne">--&gt; </span><span class="mi">144</span> <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">transforms</span> <span class="k">as</span> <span class="n">mtransforms</span>
<span class="g g-Whitespace">    </span><span class="mi">146</span> <span class="n">_log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">148</span> <span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;TickHelper&#39;</span><span class="p">,</span> <span class="s1">&#39;Formatter&#39;</span><span class="p">,</span> <span class="s1">&#39;FixedFormatter&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">149</span>            <span class="s1">&#39;NullFormatter&#39;</span><span class="p">,</span> <span class="s1">&#39;FuncFormatter&#39;</span><span class="p">,</span> <span class="s1">&#39;FormatStrFormatter&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">150</span>            <span class="s1">&#39;StrMethodFormatter&#39;</span><span class="p">,</span> <span class="s1">&#39;ScalarFormatter&#39;</span><span class="p">,</span> <span class="s1">&#39;LogFormatter&#39;</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">156</span>            <span class="s1">&#39;MultipleLocator&#39;</span><span class="p">,</span> <span class="s1">&#39;MaxNLocator&#39;</span><span class="p">,</span> <span class="s1">&#39;AutoMinorLocator&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">157</span>            <span class="s1">&#39;SymmetricalLogLocator&#39;</span><span class="p">,</span> <span class="s1">&#39;AsinhLocator&#39;</span><span class="p">,</span> <span class="s1">&#39;LogitLocator&#39;</span><span class="p">)</span>

<span class="n">File</span> <span class="o">~/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.12</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">matplotlib</span><span class="o">/</span><span class="n">transforms</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">49</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span> <span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">inv</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span> <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">_api</span>
<span class="ne">---&gt; </span><span class="mi">49</span> <span class="kn">from</span> <span class="nn">matplotlib._path</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">50</span>     <span class="n">affine_transform</span><span class="p">,</span> <span class="n">count_bboxes_overlapping_bbox</span><span class="p">,</span> <span class="n">update_path_extents</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">51</span> <span class="kn">from</span> <span class="nn">.path</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span> <span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">False</span>

<span class="ne">ImportError</span>: initialization failed
</pre></div>
</div>
</div>
</div>
</section>
<section id="przyklad-2-regresja-transformacje-i-cechy-wielomianowe">
<h2>Przykład 2: Regresja - Transformacje i cechy wielomianowe<a class="headerlink" href="#przyklad-2-regresja-transformacje-i-cechy-wielomianowe" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_california_housing</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">PolynomialFeatures</span><span class="p">,</span> <span class="n">PowerTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">SelectKBest</span><span class="p">,</span> <span class="n">f_regression</span><span class="p">,</span> <span class="n">RFE</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="c1"># Załadowanie danych</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">fetch_california_housing</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">feature_names</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">target</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PROBLEM: PRZEWIDYWANIE CEN DOMÓW W KALIFORNII&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Rozmiar zbioru: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Opis cech:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">feature_names</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">feature_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Statystyki:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="c1"># Analiza rozkładów</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wartość&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Częstość&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INŻYNIERIA CECH DLA REGRESJI&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>

<span class="c1"># KROK 1: Transformacje nieliniowe dla skośnych rozkładów</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">KROK 1: Transformacje nieliniowe&quot;</span><span class="p">)</span>

<span class="n">X_train_fe</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">X_test_fe</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Log transform dla cech ze skośnym rozkładem</span>
<span class="n">skewed_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Population&#39;</span><span class="p">,</span> <span class="s1">&#39;AveOccup&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">skewed_features</span><span class="p">:</span>
    <span class="c1"># Dodaj małą stałą aby uniknąć log(0)</span>
    <span class="n">X_train_fe</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">feat</span><span class="si">}</span><span class="s1">_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">X_train_fe</span><span class="p">[</span><span class="n">feat</span><span class="p">])</span>
    <span class="n">X_test_fe</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">feat</span><span class="si">}</span><span class="s1">_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">X_test_fe</span><span class="p">[</span><span class="n">feat</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Utworzono </span><span class="si">{</span><span class="n">feat</span><span class="si">}</span><span class="s2">_log&quot;</span><span class="p">)</span>

<span class="c1"># Square root transform</span>
<span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;MedInc_sqrt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;MedInc&#39;</span><span class="p">])</span>
<span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;MedInc_sqrt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;MedInc&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Utworzono MedInc_sqrt&quot;</span><span class="p">)</span>

<span class="c1"># Box-Cox transform dla wszystkich dodatnich cech</span>
<span class="n">pt</span> <span class="o">=</span> <span class="n">PowerTransformer</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;yeo-johnson&#39;</span><span class="p">,</span> <span class="n">standardize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">transformed_features</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train_fe</span><span class="p">[[</span><span class="s1">&#39;AveRooms&#39;</span><span class="p">,</span> <span class="s1">&#39;AveBedrms&#39;</span><span class="p">]])</span>
<span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;AveRooms_boxcox&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transformed_features</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;AveBedrms_boxcox&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transformed_features</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">transformed_features_test</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_fe</span><span class="p">[[</span><span class="s1">&#39;AveRooms&#39;</span><span class="p">,</span> <span class="s1">&#39;AveBedrms&#39;</span><span class="p">]])</span>
<span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;AveRooms_boxcox&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transformed_features_test</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;AveBedrms_boxcox&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transformed_features_test</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Utworzono AveRooms_boxcox, AveBedrms_boxcox&quot;</span><span class="p">)</span>

<span class="c1"># KROK 2: Tworzenie cech domenowych</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">KROK 2: Tworzenie cech domenowych&quot;</span><span class="p">)</span>

<span class="c1"># Stosunek pokoi do sypialni</span>
<span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;RoomBedroomRatio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;AveRooms&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;AveBedrms&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-5</span><span class="p">)</span>
<span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;RoomBedroomRatio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;AveRooms&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;AveBedrms&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  RoomBedroomRatio: stosunek pokoi do sypialni&quot;</span><span class="p">)</span>

<span class="c1"># Gęstość populacji</span>
<span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;PopulationDensity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;Population&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;AveOccup&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-5</span><span class="p">)</span>
<span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;PopulationDensity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;Population&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;AveOccup&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  PopulationDensity: gęstość zaludnienia&quot;</span><span class="p">)</span>

<span class="c1"># Dochód per capita w gospodarstwie domowym</span>
<span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;IncomePerPerson&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;MedInc&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;AveOccup&#39;</span><span class="p">]</span>
<span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;IncomePerPerson&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;MedInc&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;AveOccup&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  IncomePerPerson: dochód na osobę&quot;</span><span class="p">)</span>

<span class="c1"># Całkowita liczba pokoi w bloku</span>
<span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;TotalRooms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;AveRooms&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;AveOccup&#39;</span><span class="p">]</span>
<span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;TotalRooms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;AveRooms&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;AveOccup&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  TotalRooms: całkowita liczba pokoi&quot;</span><span class="p">)</span>

<span class="c1"># KROK 3: Binning - dyskretyzacja ciągłych zmiennych</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">KROK 3: Binning zmiennych ciągłych&quot;</span><span class="p">)</span>

<span class="c1"># Binning dla HouseAge</span>
<span class="n">age_bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">52</span><span class="p">]</span>
<span class="n">age_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;VeryNew&#39;</span><span class="p">,</span> <span class="s1">&#39;New&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium&#39;</span><span class="p">,</span> <span class="s1">&#39;Old&#39;</span><span class="p">]</span>
<span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;HouseAge_binned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;HouseAge&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">age_bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">age_labels</span><span class="p">)</span>
<span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;HouseAge_binned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;HouseAge&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">age_bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">age_labels</span><span class="p">)</span>

<span class="c1"># One-hot encoding dla zbinowanego wieku</span>
<span class="n">age_dummies_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">X_train_fe</span><span class="p">[</span><span class="s1">&#39;HouseAge_binned&#39;</span><span class="p">],</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">age_dummies_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">X_test_fe</span><span class="p">[</span><span class="s1">&#39;HouseAge_binned&#39;</span><span class="p">],</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">X_train_fe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_train_fe</span><span class="p">,</span> <span class="n">age_dummies_train</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_test_fe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_test_fe</span><span class="p">,</span> <span class="n">age_dummies_test</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_train_fe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;HouseAge_binned&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_test_fe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;HouseAge_binned&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  HouseAge podzielony na kategorie: VeryNew, New, Medium, Old&quot;</span><span class="p">)</span>

<span class="c1"># KROK 4: Cechy wielomianowe (interakcje)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">KROK 4: Cechy wielomianowe i interakcje&quot;</span><span class="p">)</span>

<span class="c1"># Wybrane interakcje zamiast wszystkich kombinacji (by uniknąć wybuchu wymiarowości)</span>
<span class="n">interaction_pairs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;MedInc&#39;</span><span class="p">,</span> <span class="s1">&#39;HouseAge&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;MedInc&#39;</span><span class="p">,</span> <span class="s1">&#39;AveRooms&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;AveRooms&#39;</span><span class="p">,</span> <span class="s1">&#39;AveBedrms&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">feat1</span><span class="p">,</span> <span class="n">feat2</span> <span class="ow">in</span> <span class="n">interaction_pairs</span><span class="p">:</span>
    <span class="n">X_train_fe</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">feat1</span><span class="si">}</span><span class="s1">_x_</span><span class="si">{</span><span class="n">feat2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_train_fe</span><span class="p">[</span><span class="n">feat1</span><span class="p">]</span> <span class="o">*</span> <span class="n">X_train_fe</span><span class="p">[</span><span class="n">feat2</span><span class="p">]</span>
    <span class="n">X_test_fe</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">feat1</span><span class="si">}</span><span class="s1">_x_</span><span class="si">{</span><span class="n">feat2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test_fe</span><span class="p">[</span><span class="n">feat1</span><span class="p">]</span> <span class="o">*</span> <span class="n">X_test_fe</span><span class="p">[</span><span class="n">feat2</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">feat1</span><span class="si">}</span><span class="s2">_x_</span><span class="si">{</span><span class="n">feat2</span><span class="si">}</span><span class="s2">: interakcja między cechami&quot;</span><span class="p">)</span>

<span class="c1"># Cechy kwadratowe dla wybranych zmiennych</span>
<span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;MedInc&#39;</span><span class="p">,</span> <span class="s1">&#39;AveRooms&#39;</span><span class="p">]:</span>
    <span class="n">X_train_fe</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">feat</span><span class="si">}</span><span class="s1">_squared&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_train_fe</span><span class="p">[</span><span class="n">feat</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">X_test_fe</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">feat</span><span class="si">}</span><span class="s1">_squared&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test_fe</span><span class="p">[</span><span class="n">feat</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">feat</span><span class="si">}</span><span class="s2">_squared: cecha kwadratowa&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Liczba cech po inżynierii: </span><span class="si">{</span><span class="n">X_train_fe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># KROK 5: Skalowanie</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">KROK 5: Skalowanie cech&quot;</span><span class="p">)</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_train_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train_fe</span><span class="p">)</span>
<span class="n">X_test_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_fe</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Wszystkie cechy przeskalowane (StandardScaler)&quot;</span><span class="p">)</span>

<span class="c1"># KROK 6: Selekcja cech</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SELEKCJA CECH&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>

<span class="c1"># Metoda 1: SelectKBest</span>
<span class="n">k_best</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">selector</span> <span class="o">=</span> <span class="n">SelectKBest</span><span class="p">(</span><span class="n">f_regression</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k_best</span><span class="p">)</span>
<span class="n">X_train_selected</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">X_test_selected</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_scaled</span><span class="p">)</span>

<span class="n">selected_features</span> <span class="o">=</span> <span class="n">X_train_fe</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">selector</span><span class="o">.</span><span class="n">get_support</span><span class="p">()]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">SelectKBest (k=</span><span class="si">{</span><span class="n">k_best</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Wybrane cechy: </span><span class="si">{</span><span class="n">selected_features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Scores dla wszystkich cech</span>
<span class="n">feature_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;feature&#39;</span><span class="p">:</span> <span class="n">X_train_fe</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
    <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">selector</span><span class="o">.</span><span class="n">scores_</span>
<span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top 10 cech według F-statistic:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">feature_scores</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># Wizualizacja</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feature_scores</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">))),</span> <span class="n">feature_scores</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)[</span><span class="s1">&#39;score&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feature_scores</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">))),</span> <span class="n">feature_scores</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)[</span><span class="s1">&#39;feature&#39;</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;F-statistic&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Top 15 cech według SelectKBest&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># KROK 7: Porównanie modeli</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PORÓWNANIE MODELI&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Model 1: Na oryginalnych cechach</span>
<span class="n">lr_original</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">scores_original</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">lr_original</span><span class="p">,</span>
                                   <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span>
                                   <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                   <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;Oryginalne cechy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">scores_original</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Model na oryginalnych cechach:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  CV RMSE: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">scores_original</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Model 2: Po inżynierii cech</span>
<span class="n">lr_fe</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">scores_fe</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">lr_fe</span><span class="p">,</span> <span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                            <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;Po inżynierii cech&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">scores_fe</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Model po inżynierii cech:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  CV RMSE: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">scores_fe</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Model 3: Po selekcji cech</span>
<span class="n">lr_selected</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">scores_selected</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">lr_selected</span><span class="p">,</span> <span class="n">X_train_selected</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                  <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;Po selekcji cech&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">scores_selected</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Model po selekcji cech:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  CV RMSE: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">scores_selected</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Wykres porównania</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span>
        <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;RMSE (niższy = lepszy)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Wpływ inżynierii cech na błąd predykcji&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Finalna ocena</span>
<span class="n">lr_fe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">lr_fe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_scaled</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FINALNA OCENA NA ZBIORZE TESTOWYM&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">RMSE: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">y_pred</span><span class="p">))</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R²: </span><span class="si">{</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">y_pred</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Wizualizacja predykcji</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">y_test</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y_test</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span> <span class="p">[</span><span class="n">y_test</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y_test</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
         <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Idealna predykcja&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Rzeczywiste wartości&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Przewidywane wartości&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Predykcje vs Rzeczywiste wartości&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Wnioski:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Transformacje nieliniowe pomogły znormalizować skośne rozkłady&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Cechy domenowe (ratios, density) wniosły dodatkową wartość&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Interakcje między cechami ujawniły ukryte zależności&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Selekcja cech zredukowała wymiarowość bez utraty wydajności&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>======================================================================
PROBLEM: PRZEWIDYWANIE CEN DOMÓW W KALIFORNII
======================================================================

Rozmiar zbioru: (20640, 9)

Opis cech:
  MedInc: MedInc
  HouseAge: HouseAge
  AveRooms: AveRooms
  AveBedrms: AveBedrms
  Population: Population
  AveOccup: AveOccup
  Latitude: Latitude
  Longitude: Longitude

Statystyki:
             MedInc      HouseAge      AveRooms     AveBedrms    Population  \
count  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000   
mean       3.870671     28.639486      5.429000      1.096675   1425.476744   
std        1.899822     12.585558      2.474173      0.473911   1132.462122   
min        0.499900      1.000000      0.846154      0.333333      3.000000   
25%        2.563400     18.000000      4.440716      1.006079    787.000000   
50%        3.534800     29.000000      5.229129      1.048780   1166.000000   
75%        4.743250     37.000000      6.052381      1.099526   1725.000000   
max       15.000100     52.000000    141.909091     34.066667  35682.000000   

           AveOccup      Latitude     Longitude        target  
count  20640.000000  20640.000000  20640.000000  20640.000000  
mean       3.070655     35.631861   -119.569704      2.068558  
std       10.386050      2.135952      2.003532      1.153956  
min        0.692308     32.540000   -124.350000      0.149990  
25%        2.429741     33.930000   -121.800000      1.196000  
50%        2.818116     34.260000   -118.490000      1.797000  
75%        3.282261     37.710000   -118.010000      2.647250  
max     1243.333333     41.950000   -114.310000      5.000010  
</pre></div>
</div>
<img alt="../../_images/adc709b44a4305bfd812121020abbebdd22f1b57e972a05bd74c9be995363447.png" src="../../_images/adc709b44a4305bfd812121020abbebdd22f1b57e972a05bd74c9be995363447.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>======================================================================
INŻYNIERIA CECH DLA REGRESJI
======================================================================

KROK 1: Transformacje nieliniowe
  Utworzono Population_log
  Utworzono AveOccup_log
  Utworzono MedInc_sqrt
  Utworzono AveRooms_boxcox, AveBedrms_boxcox

KROK 2: Tworzenie cech domenowych
  RoomBedroomRatio: stosunek pokoi do sypialni
  PopulationDensity: gęstość zaludnienia
  IncomePerPerson: dochód na osobę
  TotalRooms: całkowita liczba pokoi

KROK 3: Binning zmiennych ciągłych
  HouseAge podzielony na kategorie: VeryNew, New, Medium, Old

KROK 4: Cechy wielomianowe i interakcje
  MedInc_x_HouseAge: interakcja między cechami
  MedInc_x_AveRooms: interakcja między cechami
  AveRooms_x_AveBedrms: interakcja między cechami
  Latitude_x_Longitude: interakcja między cechami
  MedInc_squared: cecha kwadratowa
  AveRooms_squared: cecha kwadratowa

Liczba cech po inżynierii: 26

KROK 5: Skalowanie cech
  Wszystkie cechy przeskalowane (StandardScaler)

======================================================================
SELEKCJA CECH
======================================================================

SelectKBest (k=15):
  Wybrane cechy: [&#39;MedInc&#39;, &#39;HouseAge&#39;, &#39;AveRooms&#39;, &#39;Latitude&#39;, &#39;AveOccup_log&#39;, &#39;MedInc_sqrt&#39;, &#39;AveRooms_boxcox&#39;, &#39;AveBedrms_boxcox&#39;, &#39;RoomBedroomRatio&#39;, &#39;IncomePerPerson&#39;, &#39;Age_New&#39;, &#39;MedInc_x_HouseAge&#39;, &#39;MedInc_x_AveRooms&#39;, &#39;Latitude_x_Longitude&#39;, &#39;MedInc_squared&#39;]

Top 10 cech według F-statistic:
              feature         score
15    IncomePerPerson  20886.502036
0              MedInc  15057.439100
10        MedInc_sqrt  14608.514919
24     MedInc_squared  10676.556262
20  MedInc_x_HouseAge   8796.244896
21  MedInc_x_AveRooms   7978.678427
13   RoomBedroomRatio   2873.899806
9        AveOccup_log   1050.063393
11    AveRooms_boxcox   1033.380014
2            AveRooms    425.373449
</pre></div>
</div>
<img alt="../../_images/ebd8492e6259789c6042164f29b4e91e1ba44b5fcaba472cfd883436ac2c084f.png" src="../../_images/ebd8492e6259789c6042164f29b4e91e1ba44b5fcaba472cfd883436ac2c084f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>======================================================================
PORÓWNANIE MODELI
======================================================================

Model na oryginalnych cechach:
  CV RMSE: 0.7206

Model po inżynierii cech:
  CV RMSE: 0.6358

Model po selekcji cech:
  CV RMSE: 0.6404
</pre></div>
</div>
<img alt="../../_images/c4332674b7e3621b7e8e85d4c622edf4ce8012e7a32510206e886f70120a0b03.png" src="../../_images/c4332674b7e3621b7e8e85d4c622edf4ce8012e7a32510206e886f70120a0b03.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>======================================================================
FINALNA OCENA NA ZBIORZE TESTOWYM
======================================================================

RMSE: 0.6834
R²: 0.6436
</pre></div>
</div>
<img alt="../../_images/4d46b3e063fdfdf3d03fb6dfa98e5e92afb9f408db044dcf7c3502811e484512.png" src="../../_images/4d46b3e063fdfdf3d03fb6dfa98e5e92afb9f408db044dcf7c3502811e484512.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Wnioski:
- Transformacje nieliniowe pomogły znormalizować skośne rozkłady
- Cechy domenowe (ratios, density) wniosły dodatkową wartość
- Interakcje między cechami ujawniły ukryte zależności
- Selekcja cech zredukowała wymiarowość bez utraty wydajności
</pre></div>
</div>
</div>
</div>
</section>
<section id="przyklad-3-klasteryzacja-redukcja-wymiarowosci-i-transformacje">
<h2>Przykład 3: Klasteryzacja - Redukcja wymiarowości i transformacje<a class="headerlink" href="#przyklad-3-klasteryzacja-redukcja-wymiarowosci-i-transformacje" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_digits</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">TSNE</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span><span class="p">,</span> <span class="n">DBSCAN</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">silhouette_score</span><span class="p">,</span> <span class="n">davies_bouldin_score</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">VarianceThreshold</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="c1"># Załadowanie danych - cyfry pisane ręcznie</span>
<span class="n">digits</span> <span class="o">=</span> <span class="n">load_digits</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">digits</span><span class="o">.</span><span class="n">data</span>
<span class="n">y_true</span> <span class="o">=</span> <span class="n">digits</span><span class="o">.</span><span class="n">target</span>  <span class="c1"># Używamy tylko do walidacji</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PROBLEM: KLASTERYZACJA OBRAZÓW CYFR&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Rozmiar zbioru: </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Liczba klas: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_true</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Opis: Każdy obraz to 8x8 pikseli (64 cechy)&quot;</span><span class="p">)</span>

<span class="c1"># Wizualizacja przykładowych obrazów</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">digits</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cyfra: </span><span class="si">{</span><span class="n">y_true</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INŻYNIERIA CECH DLA KLASTERYZACJI&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>

<span class="c1"># KROK 1: Podstawowe statystyki</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">KROK 1: Analiza i czyszczenie danych&quot;</span><span class="p">)</span>

<span class="c1"># Sprawdzenie wariancji cech</span>
<span class="n">variances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Statystyki wariancji cech:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Min wariancja: </span><span class="si">{</span><span class="n">variances</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Max wariancja: </span><span class="si">{</span><span class="n">variances</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Średnia wariancja: </span><span class="si">{</span><span class="n">variances</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Usunięcie cech z bardzo niską wariancją (jeśli są)</span>
<span class="n">selector</span> <span class="o">=</span> <span class="n">VarianceThreshold</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">X_var_filtered</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Cechy po filtrowaniu wariancji: </span><span class="si">{</span><span class="n">X_var_filtered</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> (było </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># KROK 2: Tworzenie nowych cech domenowych</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">KROK 2: Tworzenie cech domenowych dla obrazów&quot;</span><span class="p">)</span>

<span class="c1"># Tworzymy DataFrame z nazwami kolumn jako stringi</span>
<span class="n">X_fe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_var_filtered</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;pixel_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X_var_filtered</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>

<span class="c1"># Statystyki intensywności pikseli</span>
<span class="n">X_fe</span><span class="p">[</span><span class="s1">&#39;mean_intensity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X_var_filtered</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_fe</span><span class="p">[</span><span class="s1">&#39;std_intensity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">X_var_filtered</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_fe</span><span class="p">[</span><span class="s1">&#39;max_intensity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">X_var_filtered</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_fe</span><span class="p">[</span><span class="s1">&#39;min_intensity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">X_var_filtered</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Dodano cechy: mean, std, max, min intensywności&quot;</span><span class="p">)</span>

<span class="c1"># Liczba &quot;aktywnych&quot; pikseli (powyżej pewnego progu)</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">X_fe</span><span class="p">[</span><span class="s1">&#39;active_pixels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">X_var_filtered</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Dodano: liczba aktywnych pikseli (&gt;</span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># Symetria (porównanie lewej i prawej połowy)</span>
<span class="c1"># Zakładamy, że obraz to 8x8, więc mamy 64 piksele</span>
<span class="n">img_width</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">left_half</span> <span class="o">=</span> <span class="n">X_var_filtered</span><span class="p">[:,</span> <span class="p">:</span><span class="n">img_width</span><span class="o">//</span><span class="mi">2</span> <span class="o">*</span> <span class="n">img_width</span><span class="p">]</span>
<span class="n">right_half</span> <span class="o">=</span> <span class="n">X_var_filtered</span><span class="p">[:,</span> <span class="n">img_width</span><span class="o">//</span><span class="mi">2</span> <span class="o">*</span> <span class="n">img_width</span><span class="p">:]</span>

<span class="k">if</span> <span class="n">left_half</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">right_half</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
    <span class="n">X_fe</span><span class="p">[</span><span class="s1">&#39;symmetry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">left_half</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">right_half</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">img_width</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">img_width</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">right_half</span><span class="o">.</span><span class="n">shape</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Dodano: miara symetrii obrazu&quot;</span><span class="p">)</span>

<span class="c1"># Gęstość pikseli (stosunek aktywnych do wszystkich)</span>
<span class="n">X_fe</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_fe</span><span class="p">[</span><span class="s1">&#39;active_pixels&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">X_var_filtered</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Dodano: gęstość pikseli&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Liczba cech po dodaniu domenowych: </span><span class="si">{</span><span class="n">X_fe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># KROK 3: Skalowanie</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">KROK 3: Skalowanie cech&quot;</span><span class="p">)</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_fe</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Wszystkie cechy przeskalowane&quot;</span><span class="p">)</span>

<span class="c1"># KROK 4: Redukcja wymiarowości - PCA</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;REDUKCJA WYMIAROWOŚCI - PCA&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>

<span class="c1"># Analiza wariancji wyjaśnionej</span>
<span class="n">pca_full</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">pca_full</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>

<span class="n">cumsum_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pca_full</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">)</span>

<span class="c1"># Wykres wariancji wyjaśnionej</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pca_full</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
             <span class="n">pca_full</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">,</span> <span class="s1">&#39;bo-&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Składowa główna&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Udział wyjaśnionej zmienności&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Wariancja wyjaśniona dla każdej składowej&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cumsum_var</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">cumsum_var</span><span class="p">,</span> <span class="s1">&#39;ro-&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;95% wariancji&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Liczba składowych&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Skumulowana wariancja wyjaśniona&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Skumulowana wariancja wyjaśniona&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Znajdź liczbę składowych dla 95% wariancji</span>
<span class="n">n_components_95</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">cumsum_var</span> <span class="o">&gt;=</span> <span class="mf">0.95</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Liczba składowych dla 95% wariancji: </span><span class="si">{</span><span class="n">n_components_95</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Redukcja do 2D dla wizualizacji</span>
<span class="n">pca_2d</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">X_pca_2d</span> <span class="o">=</span> <span class="n">pca_2d</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;wariancja wyjaśniona (2D): </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">pca_2d</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Redukcja do optymalnej liczby składowych</span>
<span class="n">pca_optimal</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components_95</span><span class="p">)</span>
<span class="n">X_pca</span> <span class="o">=</span> <span class="n">pca_optimal</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Zredukowano wymiarowość z </span><span class="si">{</span><span class="n">X_scaled</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> do </span><span class="si">{</span><span class="n">X_pca</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> cech&quot;</span><span class="p">)</span>

<span class="c1"># KROK 5: t-SNE dla porównania</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;REDUKCJA WYMIAROWOŚCI - t-SNE&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Obliczanie t-SNE (może potrwać chwilę)...&quot;</span><span class="p">)</span>
<span class="n">tsne</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">perplexity</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">X_tsne</span> <span class="o">=</span> <span class="n">tsne</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;t-SNE zakończone&quot;</span><span class="p">)</span>

<span class="c1"># KROK 6: Klasteryzacja i porównanie</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;KLASTERYZACJA - PORÓWNANIE PRZESTRZENI CECH&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>

<span class="n">n_clusters</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Wiemy, że są cyfry 0-9</span>

<span class="n">datasets</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Oryginalne cechy&#39;</span><span class="p">:</span> <span class="n">X_scaled</span><span class="p">,</span>
    <span class="s1">&#39;PCA (2D)&#39;</span><span class="p">:</span> <span class="n">X_pca_2d</span><span class="p">,</span>
    <span class="s1">&#39;PCA (optimal)&#39;</span><span class="p">:</span> <span class="n">X_pca</span><span class="p">,</span>
    <span class="s1">&#39;t-SNE (2D)&#39;</span><span class="p">:</span> <span class="n">X_tsne</span>
<span class="p">}</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">datasets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">n_clusters</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">silhouette</span> <span class="o">=</span> <span class="n">silhouette_score</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
    <span class="n">davies_bouldin</span> <span class="o">=</span> <span class="n">davies_bouldin_score</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

    <span class="n">results</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;silhouette&#39;</span><span class="p">:</span> <span class="n">silhouette</span><span class="p">,</span>
        <span class="s1">&#39;davies_bouldin&#39;</span><span class="p">:</span> <span class="n">davies_bouldin</span><span class="p">,</span>
        <span class="s1">&#39;labels&#39;</span><span class="p">:</span> <span class="n">labels</span>
    <span class="p">}</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> cech):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Współczynnik silhouette score: </span><span class="si">{</span><span class="n">silhouette</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Indeks Daviesa-Bouldina: </span><span class="si">{</span><span class="n">davies_bouldin</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Wizualizacja klasteryzacji dla przestrzeni 2D</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="c1"># PCA 2D - rzeczywiste etykiety</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_pca_2d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_pca_2d</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">y_true</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;tab10&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PCA 2D - Prawdziwe etykiety&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;PC1&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PC2&#39;</span><span class="p">)</span>

<span class="c1"># PCA 2D - klastry</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_pca_2d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_pca_2d</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                   <span class="n">c</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;PCA (2D)&#39;</span><span class="p">][</span><span class="s1">&#39;labels&#39;</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;tab10&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PCA 2D - Klastry K-Means</span><span class="se">\n</span><span class="s2">Silhouette: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;PCA (2D)&#39;</span><span class="p">][</span><span class="s1">&#39;silhouette&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;PC1&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PC2&#39;</span><span class="p">)</span>

<span class="c1"># t-SNE - rzeczywiste etykiety</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_tsne</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_tsne</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">y_true</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;tab10&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;t-SNE - Prawdziwe etykiety&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;t-SNE 1&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;t-SNE 2&#39;</span><span class="p">)</span>

<span class="c1"># t-SNE - klastry</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_tsne</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_tsne</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                   <span class="n">c</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;t-SNE (2D)&#39;</span><span class="p">][</span><span class="s1">&#39;labels&#39;</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;tab10&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t-SNE - Klastry K-Means</span><span class="se">\n</span><span class="s2">Silhouette: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;t-SNE (2D)&#39;</span><span class="p">][</span><span class="s1">&#39;silhouette&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;t-SNE 1&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;t-SNE 2&#39;</span><span class="p">)</span>

<span class="c1"># Porównanie metryk</span>
<span class="n">metrics_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">silhouette_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;silhouette&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">metrics_names</span><span class="p">]</span>
<span class="n">davies_bouldin_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;davies_bouldin&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">metrics_names</span><span class="p">]</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metrics_names</span><span class="p">)),</span> <span class="n">silhouette_scores</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metrics_names</span><span class="p">)))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">metrics_names</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Współczynnik silhouette score&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Współczynnik silhouette score (wyższy = lepszy)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metrics_names</span><span class="p">)),</span> <span class="n">davies_bouldin_scores</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metrics_names</span><span class="p">)))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">metrics_names</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Indeks Daviesa-Bouldina&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Indeks Daviesa-Bouldina (niższy = lepszy)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ANALIZA KOMPONENTÓW PCA&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>

<span class="c1"># Wizualizacja najważniejszych komponentów</span>
<span class="c1"># UWAGA: Musimy użyć PCA na ORYGINALNYCH danych (64 piksele), nie na rozszerzonych</span>
<span class="n">pca_viz</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">pca_viz</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_var_filtered</span><span class="p">)</span>  <span class="c1"># Tylko oryginalne piksele</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
    <span class="c1"># Każdy komponent to 64 wartości (odpowiadające 64 pikselom)</span>
    <span class="n">component</span> <span class="o">=</span> <span class="n">pca_viz</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="c1"># Reshape do 8x8</span>
    <span class="k">if</span> <span class="n">X_var_filtered</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">64</span><span class="p">:</span>
        <span class="n">component_img</span> <span class="o">=</span> <span class="n">component</span><span class="p">[:</span><span class="mi">64</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Jeśli mniej niż 64, dopełnij zerami</span>
        <span class="n">component_padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>
        <span class="n">component_padded</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">component</span><span class="p">)]</span> <span class="o">=</span> <span class="n">component</span>
        <span class="n">component_img</span> <span class="o">=</span> <span class="n">component_padded</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">component_img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;PC</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="se">\n</span><span class="s1">(</span><span class="si">{</span><span class="n">pca_viz</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
                 <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Pierwsze 8 komponentów głównych PCA</span><span class="se">\n</span><span class="s1">(na oryginalnych pikselach 8×8)&#39;</span><span class="p">,</span>
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Uwaga: Komponenty PCA są wizualizowane jako obrazy 8×8&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Jaśniejsze obszary = dodatni wpływ, ciemniejsze = ujemny wpływ piksela&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Wnioski:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- PCA skutecznie redukuje wymiarowość zachowując większość informacji&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- t-SNE lepiej rozdziela klastry wizualnie, ale nie zachowuje globalnej struktury&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Cechy domenowe (intensywność, gęstość) mogą poprawić klasteryzację&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Wybór przestrzeni cech wpływa na jakość klasteryzacji&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Redukcja wymiarowości jest kluczowa dla wysokowymiarowych danych&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>======================================================================
PROBLEM: KLASTERYZACJA OBRAZÓW CYFR
======================================================================

Rozmiar zbioru: (1797, 64)
Liczba klas: 10
Opis: Każdy obraz to 8x8 pikseli (64 cechy)
</pre></div>
</div>
<img alt="../../_images/ea778db12f8c102ec40f162bd21c75ebf0c9c4169ef022a85747ea25edef8c48.png" src="../../_images/ea778db12f8c102ec40f162bd21c75ebf0c9c4169ef022a85747ea25edef8c48.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>======================================================================
INŻYNIERIA CECH DLA KLASTERYZACJI
======================================================================

KROK 1: Analiza i czyszczenie danych

Statystyki wariancji cech:
  Min wariancja: 0.0000
  Max wariancja: 42.7211
  Średnia wariancja: 18.7731

Cechy po filtrowaniu wariancji: 48 (było 64)

KROK 2: Tworzenie cech domenowych dla obrazów
  Dodano cechy: mean, std, max, min intensywności
  Dodano: liczba aktywnych pikseli (&gt;8)
  Dodano: gęstość pikseli

Liczba cech po dodaniu domenowych: 54

KROK 3: Skalowanie cech
  Wszystkie cechy przeskalowane

======================================================================
REDUKCJA WYMIAROWOŚCI - PCA
======================================================================
</pre></div>
</div>
<img alt="../../_images/c84f6f7401bc2cfec74d35bbde648d26e814f62d478bb4f972ad8e279acffdcb.png" src="../../_images/c84f6f7401bc2cfec74d35bbde648d26e814f62d478bb4f972ad8e279acffdcb.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Liczba składowych dla 95% wariancji: 33
wariancja wyjaśniona (2D): 0.2382
Zredukowano wymiarowość z 54 do 33 cech

======================================================================
REDUKCJA WYMIAROWOŚCI - t-SNE
======================================================================
Obliczanie t-SNE (może potrwać chwilę)...
t-SNE zakończone

======================================================================
KLASTERYZACJA - PORÓWNANIE PRZESTRZENI CECH
======================================================================

Oryginalne cechy (54 cech):
  Współczynnik silhouette score: 0.1536
  Indeks Daviesa-Bouldina: 1.8883

PCA (2D) (2 cech):
  Współczynnik silhouette score: 0.3833
  Indeks Daviesa-Bouldina: 0.7908

PCA (optimal) (33 cech):
  Współczynnik silhouette score: 0.1530
  Indeks Daviesa-Bouldina: 1.9862

t-SNE (2D) (2 cech):
  Współczynnik silhouette score: 0.5743
  Indeks Daviesa-Bouldina: 0.5910
</pre></div>
</div>
<img alt="../../_images/f432b69993954150d813c4eea7b24892a4c113622aaad49bf4e5107ad4a9e913.png" src="../../_images/f432b69993954150d813c4eea7b24892a4c113622aaad49bf4e5107ad4a9e913.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>======================================================================
ANALIZA KOMPONENTÓW PCA
======================================================================
</pre></div>
</div>
<img alt="../../_images/973f848094a7b10fd22d77fa0eeb665fcbad03ed7afdd6fa16e264ef70bd807f.png" src="../../_images/973f848094a7b10fd22d77fa0eeb665fcbad03ed7afdd6fa16e264ef70bd807f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Uwaga: Komponenty PCA są wizualizowane jako obrazy 8×8
Jaśniejsze obszary = dodatni wpływ, ciemniejsze = ujemny wpływ piksela

Wnioski:
- PCA skutecznie redukuje wymiarowość zachowując większość informacji
- t-SNE lepiej rozdziela klastry wizualnie, ale nie zachowuje globalnej struktury
- Cechy domenowe (intensywność, gęstość) mogą poprawić klasteryzację
- Wybór przestrzeni cech wpływa na jakość klasteryzacji
- Redukcja wymiarowości jest kluczowa dla wysokowymiarowych danych
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="podsumowanie">
<h1>Podsumowanie<a class="headerlink" href="#podsumowanie" title="Link to this heading">#</a></h1>
<p>Najważniejsze zasady inżynierii cech:</p>
<ol class="arabic simple">
<li><p><strong>Rozumienie danych</strong> - zacznij od eksploracji i analizy danych</p></li>
<li><p><strong>Wiedza domenowa</strong> - używaj wiedzy o problemie do tworzenia sensownych cech</p></li>
<li><p><strong>Iteracyjność</strong> - inżynieria cech to proces iteracyjny, testuj różne pomysły</p></li>
<li><p><strong>Transformacje</strong> - normalizuj rozkłady, skaluj cechy</p></li>
<li><p><strong>Tworzenie interakcji</strong> - kombinuj cechy aby ujawnić ukryte zależności</p></li>
<li><p><strong>Selekcja cech</strong> - usuń zbędne cechy aby uniknąć przeuczenia</p></li>
<li><p><strong>Walidacja</strong> - zawsze sprawdzaj wpływ nowych cech na wydajność modelu</p></li>
<li><p><strong>Leakage</strong> - uważaj na wyciek informacji ze zbioru testowego</p></li>
<li><p><strong>Automatyzacja</strong> - używaj pipeline’ów do reprodukowalności</p></li>
<li><p><strong>Dokumentacja</strong> - zapisuj proces tworzenia cech dla późniejszego użycia</p></li>
</ol>
<section id="dodatkowe-techniki">
<h2>Dodatkowe techniki<a class="headerlink" href="#dodatkowe-techniki" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>“Target encoding”</strong> - kodowanie kategorii na podstawie wartości docelowej (trzeba uważać na przeuczenie)</p></li>
<li><p><strong>“Embedding”</strong> - reprezentacje uczone przez sieci neuronowe</p></li>
<li><p><strong>“Feature hashing”</strong> - dla bardzo wysokich wymiarowości</p></li>
<li><p><strong>“Time-based features”</strong> - opóźnienia, średnie kroczące, trendy</p></li>
</ul>
</section>
<section id="narzedzia">
<h2>Narzędzia<a class="headerlink" href="#narzedzia" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Feature-engine</strong> - biblioteka dedykowana inżynierii cech</p></li>
<li><p><strong>Category Encoders</strong> - różne metody kodowania zmiennych kategorycznych</p></li>
<li><p><strong>TPOT / Auto-sklearn</strong> - automatyczna inżynieria cech</p></li>
<li><p><strong>Featuretools</strong> - automatyczne tworzenie cech z danych relacyjnych</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./produkcja/dane"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Inżynieria cech</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wprowadzenie">Wprowadzenie</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#podstawowe-techniki-inzynierii-cech">Podstawowe techniki inżynierii cech</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transformacje-numeryczne">1. Transformacje numeryczne</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kodowanie-zmiennych-kategorycznych">2. Kodowanie zmiennych kategorycznych</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tworzenie-nowych-cech">3. Tworzenie nowych cech</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selekcja-cech">4. Selekcja cech</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ekstrakcja-cech">5. Ekstrakcja cech</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#przyklad-1-klasyfikacja-kompleksowa-inzynieria-cech-dla-zbioru-ocalalych-z-katastrofy-titanica">Przykład 1: Klasyfikacja - Kompleksowa inżynieria cech dla zbioru ocalałych z katastrofy Titanica</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#przyklad-2-regresja-transformacje-i-cechy-wielomianowe">Przykład 2: Regresja - Transformacje i cechy wielomianowe</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#przyklad-3-klasteryzacja-redukcja-wymiarowosci-i-transformacje">Przykład 3: Klasteryzacja - Redukcja wymiarowości i transformacje</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#podsumowanie">Podsumowanie</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dodatkowe-techniki">Dodatkowe techniki</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#narzedzia">Narzędzia</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Maciej Janowicz
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>